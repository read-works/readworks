import{a as V}from"./chunk-O2ZDC4GV.js";import{a as z,c as X,e as q}from"./chunk-IBIHUJR6.js";import{c as F}from"./chunk-G3MELPCC.js";import{a as U}from"./chunk-5ESBBNVT.js";import{A as d,C as E,Ia as R,Ja as P,Ka as T,L,M,N as a,U as y,Z as B,_a as A,aa as k,ca as O,fa as h,ga as C,hb as W,ia as N,ja as w,ka as i,la as s,pa as S,s as v,sa as b,tb as $,ub as H,w as p,wa as l,xa as r,xb as G,z as c}from"./chunk-V52KVE3Z.js";var j=(()=>{class n{http=p(W);bookmark(e,t){return this.http.post(`${A.api}page/bookmarks`,{pageId:e,bookmarked:t});}fetchBookmarks(e,t){return this.http.get(`${A.api}page/bookmarks/${e}/${t}`);}static ɵfac=function(t){return new(t||n)();};static ɵprov=v({token:n,factory:n.ɵfac,providedIn:"root"});}return n;})();function J(n,m){n&1&&(i(0,"h2",5),b(1,0),s());}function Q(n,m){if(n&1){let e=S();i(0,"rw-page-image",8),l("clicked",function(o){c(e);let _=r(3);return d(_.openBookmarkedPage(o));}),i(1,"div",9)(2,"span",10),R(3),s(),i(4,"div")(5,"rw-button",11),l("clicked",function(){let o=c(e).$implicit,_=r(3);return d(_.deleteBookmark(o.id));}),s(),i(6,"rw-button",12),l("clicked",function(){let o=c(e).$implicit,_=r(3);return d(_.openEditorFor(o));}),s()()()();}if(n&2){let e=m.$implicit;k("page",e)("showContext",!0)("showLightModeShadow",!1),a(3),P(e.pageNumber),a(3),k("hint",e.noteCount?e.noteCount.toString():void 0);}}function Y(n,m){if(n&1&&(i(0,"h3",6),R(1),i(2,"span"),b(3,1),s()(),N(4,Q,7,5,"rw-page-image",7,h().pageTrackByFunction,!0)),n&2){let e=r(2);a(),T(" ",e.bookmarks.currentDocument.documentName.replace(".pdf","")," "),a(3),w(e.bookmarks.currentDocument.pages);}}function ee(n,m){if(n&1){let e=S();i(0,"rw-page-image",15),l("clicked",function(o){c(e);let _=r(4);return d(_.openBookmarkedPage(o));}),i(1,"div",9)(2,"span",10),R(3),s(),i(4,"div",16)(5,"rw-button",17),l("clicked",function(){let o=c(e).$implicit,_=r(4);return d(_.deleteBookmark(o.id));}),s(),i(6,"rw-button",18),l("clicked",function(){let o=c(e).$implicit,_=r(4);return d(_.openEditorFor(o));}),s()()()();}if(n&2){let e=m.$implicit,t=r(4);k("page",e)("showContext",!0)("showLightModeShadow",t.showLightModeShadow),a(3),P(e.pageNumber),a(3),k("hint",e.noteCount?e.noteCount.toString():void 0);}}function te(n,m){if(n&1&&(i(0,"h3",13),R(1),s(),N(2,ee,7,5,"rw-page-image",14,h().pageTrackByFunction,!0)),n&2){let e=m.$implicit,t=r(3);O("text-slate-600",t.standalone)("dark:text-white",t.standalone)("text-white",!t.standalone),a(),T(" ",e.documentName," "),a(),w(e.pages);}}function oe(n,m){if(n&1&&N(0,te,4,7,null,null,h().caseTrackByFunction,!0),n&2){let e=r(2);w(e.bookmarks.caseDocuments);}}function ne(n,m){if(n&1){let e=S();i(0,"div",4),l("click",function(o){c(e);let _=r();return d(_.deadSpaceClick(o));}),B(1,J,2,0,"h2",5)(2,Y,6,1)(3,oe,2,0),s();}if(n&2){let e=r();a(),C(e.noHeadline?-1:1),a(),C(e.bookmarks&&e.bookmarks.currentDocument?2:-1),a(),C(e.bookmarks&&e.bookmarks.caseDocuments?3:-1);}}function _e(n,m){if(n&1){let e=S();i(0,"rw-note",19),l("closeNotes",function(){c(e);let o=r();return d(o.pageToAttachNote=void 0);}),s();}if(n&2){let e=r();k("page",e.pageToAttachNote);}}function re(n,m){if(n&1){let e=S();i(0,"rw-button",28),l("clicked",function(){c(e);let o=r(2);return d(o.openEditorFor(o.page));}),s();}if(n&2){let e=r(2);k("hint",e.page.noteCount?e.page.noteCount.toString():void 0);}}function ie(n,m){if(n&1){let e=S();i(0,"rw-image-viewer",20),l("zoomed",function(o){c(e);let _=r();return d(_.checkZoomed(o));})("deadSpaceClicked",function(o){c(e);let _=r();return d(_.deadSpaceClick(o));}),s(),i(1,"div",21)(2,"div",22)(3,"div",23),B(4,re,1,1,"rw-button",24),i(5,"rw-button",25),l("clicked",function(){c(e);let o=r();return d(o.page&&o.slide(o.page.id,-1));}),s(),i(6,"rw-button",26),l("clicked",function(){c(e);let o=r();return d(o.closeOpenedBookmarkPage());}),s(),i(7,"rw-button",27),l("clicked",function(){c(e);let o=r();return d(o.page&&o.slide(o.page.id,1));}),s()()()();}if(n&2){let e=r();k("page",e.page)("calcMargins",!0)("progress",(e.getSlideIndex(e.page.id)||.001)*100/(e.slidePages.length-1)),a(2),O("blendIn",e.blendInControls),a(2),C(e.page?4:-1),a(),O("pointer-events-none",!1),k("disabled",e.page&&e.getSlideIndex(e.page.id)===0),a(2),O("pointer-events-none",!1),k("disabled",e.page&&e.getSlideIndex(e.page.id)===e.slidePages.length-1);}}var Me=(()=>{class n{pageService=p(j);documentService=p(V);settingsService=p($);iaService=p(H);subscriptionStore=p(F);socket=p(U);currentCase;currentDocument;openedPageId;noHeadline=!1;standalone=!1;showLightModeShadow=!1;bookmarkForPageChanged=new E();deadSpaceClicked=new E();detailViewActive=new E();escapeKeyPressed=new E();bookmarks;page;zoomed=!1;blendInControls=!1;document="";slidePages=[];pageToAttachNote;iaLayer="bookmark-browser";close(){this.page&&this.iaService.is(this.iaLayer)?this.closeOpenedBookmarkPage():!this.page&&this.iaService.is(this.iaLayer)&&(this.standalone&&this.ngOnDestroy(),requestAnimationFrame(()=>{this.escapeKeyPressed.next();}));}previous(){this.page&&this.getSlideIndex(this.page.id)!==this.slidePages.length-1&&this.standalone&&this.iaService.is(this.iaLayer)&&this.slide(this.page.id,1);}next(){this.page&&this.getSlideIndex(this.page.id)!==0&&this.standalone&&this.iaService.is(this.iaLayer)&&this.slide(this.page.id,-1);}constructor(){this.iaService.add(this.iaLayer),this.closeOpenedBookmarkPage();let e=this.subscriptionStore.getStore("bookmarkBrowserComponent");e.push(this.settingsService.fetchSettings().subscribe(t=>{this.blendInControls=t.blendControls;})),e.push(this.socket.fromEvent("updateBookmarks").subscribe(()=>{e.push(this.fetchBookmarks());})),e.push(this.socket.fromEvent("update").subscribe(t=>{["documentDestroyed","searchCreated","searchDeleted","searchResultExcluded","noteCreated","noteDeleted"].includes(t.name)&&e.push(this.fetchBookmarks());}));}ngOnInit(){this.fetchBookmarks();}ngOnDestroy(){this.subscriptionStore.destroy("bookmarkBrowserComponent"),this.iaService.take(this.iaLayer);}fetchBookmarks(){return this.pageService.fetchBookmarks(this.currentCase,this.currentDocument).subscribe(e=>{this.bookmarks?(this.bookmarks.currentDocument=e.currentDocument,this.bookmarks.caseDocuments=e.caseDocuments):this.bookmarks=e,this.syncOpenedBookmarkPage(),this.syncOpenedNotePage(),this.syncSlideList();});}syncSlideList(){this.slidePages=[],this.bookmarks.currentDocument&&this.bookmarks.currentDocument.pages.forEach(e=>{this.slidePages.push(e);}),this.bookmarks.caseDocuments&&this.bookmarks.caseDocuments.forEach(e=>{e.pages&&e.pages.forEach(t=>{this.slidePages.push(t);});});}getSlideIndex(e){let t=null;return e===0||this.slidePages.some((o,_)=>e!==o.id?!1:(t=_,!0)),t;}slide(e,t){let o=this.getSlideIndex(e);if(o!==null){if(t===-1){this.openBookmarkedPage(this.slidePages[o-1]);return;}if(t===1){this.openBookmarkedPage(this.slidePages[o+1]);return;}}}checkZoomed(e){this.zoomed=e;}deleteBookmark(e){e===this.openedPageId&&this.bookmarkForPageChanged.emit(),this.pageService.bookmark(e,!1).subscribe();}caseTrackByFunction(e,t){return t.documentName;}pageTrackByFunction(e,t){return t.filename;}deadSpaceClick(e){e.currentTarget===e.target&&this.deadSpaceClicked.emit(e);}openEditorFor(e){this.pageToAttachNote=e;}openBookmarkedPage(e){this.documentService.fetchPage(e.documentId.toString(),e.id).subscribe(t=>{this.page=t,this.detailViewActive.next(!0);});}closeOpenedBookmarkPage(){this.page=void 0,this.detailViewActive.next(!1);}comparePageId(e,t,o){return t!==e?!1:(this.openBookmarkedPage(o),!0);}syncOpenedBookmarkPage(){let e=this.page?.id;if(e){let t=!1;this.bookmarks.currentDocument&&(t=t||this.bookmarks.currentDocument.pages.some(o=>this.comparePageId(e,o.id,o))),!t&&this.bookmarks.caseDocuments&&this.bookmarks.caseDocuments.length&&(t=t||this.bookmarks.caseDocuments.some(o=>o.pages.some(_=>this.comparePageId(e,_.id,_)))),t||this.closeOpenedBookmarkPage();}}syncOpenedNotePage(){if(this.pageToAttachNote?.id){let t=!1;this.bookmarks.currentDocument&&(t=t||this.bookmarks.currentDocument.pages.some(o=>{if(o.id===this.pageToAttachNote?.id)return this.pageToAttachNote=o,!0;})),!t&&this.bookmarks.caseDocuments&&this.bookmarks.caseDocuments.length&&(t=t||this.bookmarks.caseDocuments.some(o=>o.pages.some(_=>{if(_.id===this.pageToAttachNote?.id)return this.pageToAttachNote=_,!0;})));}}Math=Math;static ɵfac=function(t){return new(t||n)();};static ɵcmp=y({type:n,selectors:[["rw-bookmark-browser"]],hostAttrs:[1,"block","w-full","h-full","py-0"],hostBindings:function(t,o){t&1&&l("keydown.escape",function(g){return o.close(g);},!1,L)("keydown.arrowright",function(g){return o.previous(g);},!1,M)("keydown.arrowleft",function(g){return o.next(g);},!1,M);},inputs:{currentCase:"currentCase",currentDocument:"currentDocument",openedPageId:"openedPageId",noHeadline:"noHeadline",standalone:"standalone",showLightModeShadow:"showLightModeShadow"},outputs:{bookmarkForPageChanged:"bookmarkForPageChanged",deadSpaceClicked:"deadSpaceClicked",detailViewActive:"detailViewActive",escapeKeyPressed:"escapeKeyPressed"},decls:3,vars:3,consts:()=>{let e;e="Lesezeichen";let t;t="(ge\xF6ffnetes Dokument)";let o;o="Lesezeichen entfernen";let _;_="Notiz(en) erstellen";let g;g="Lesezeichen entfernen";let D;D="Notiz(en) erstellen";let f;f="Notiz(en) erstellen";let x;x="Zur\xFCck zum letzten Lesezeichen";let K;K="Lesezeichen schlie\xDFen (ESC)";let I;return I="Weiter zum n\xE4chsten Lesezeichen",[e,t,[1,"px-1.5","md:px-3","overflow-y-scroll","h-full"],[3,"page"],[1,"px-1.5","md:px-3","overflow-y-scroll","h-full",3,"click"],[1,"text-xl","md:text-2xl","text-white","block","my-1.5"],[1,"current-document-headline","text-lg","md:text-xl","text-white"],[1,"current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"page","showContext","showLightModeShadow"],[1,"current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"clicked","page","showContext","showLightModeShadow"],[1,"text-xs","-mt-5","relative","pointer-events-none"],[1,"text-black","pointer-events-none","text-center","px-1","border","border-black","rounded-lg","bg-white","bg-opacity-70","border-opacity-20"],["title",o,"icon","bookmark-dash-fill","styling","standard",1,"scale-75","inline-block","pointer-events-auto",3,"clicked"],["title",_,"icon","pencil-square","styling","standard",1,"scale-75","inline-block","pointer-events-auto",3,"clicked","hint"],[1,"bookmarked-documents-headline","mt-6","text-lg"],[1,"bookmarked-documents-bookmark","current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"page","showContext","showLightModeShadow"],[1,"bookmarked-documents-bookmark","current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"clicked","page","showContext","showLightModeShadow"],[1,"mt-2"],["title",g,"icon","bookmark-dash-fill","styling","standard",1,"scale-75","inline-block","pointer-events-auto",3,"clicked"],["title",D,"icon","pencil-square","styling","standard",1,"scale-75","inline-block","pointer-events-auto",3,"clicked","hint"],[3,"closeNotes","page"],[3,"zoomed","deadSpaceClicked","page","calcMargins","progress"],[1,"relative"],[1,"absolute","left-0","bottom-0","right-0","py-3","z-20","transition-all","duration-300","scale-50","sm:scale-75","md:scale-100"],[1,"mx-auto","whitespace-nowrap","max-w-[70%]","text-center"],["icon","pencil-square","styling","standard","title",f,1,"mx-1.5",3,"hint"],["title",x,"icon","chevron-left","styling","main",1,"mx-1.5",3,"clicked","disabled"],["styling","standard","icon","x-lg","title",K,1,"mx-1.5",3,"clicked"],["title",I,"icon","chevron-right","styling","main",1,"mx-1.5",3,"clicked","disabled"],["icon","pencil-square","styling","standard","title",f,1,"mx-1.5",3,"clicked","hint"]];},template:function(t,o){t&1&&B(0,ne,4,3,"div",2)(1,_e,1,1,"rw-note",3)(2,ie,8,12),t&2&&(C(o.page?-1:0),a(),C(o.pageToAttachNote?1:-1),a(),C(o.page?2:-1));},dependencies:[z,G,q,X],styles:["@media (min-width: 768px){.blendIn[_ngcontent-%COMP%]{bottom:-3rem}}.blendIn[_ngcontent-%COMP%]:hover{bottom:-.375rem}"]});}return n;})();export{j as a,Me as b};/**i18n:1964dde12af7df15d0053ab7761c4e4c56fe7eae085ef9e01bc7588ce5d2189d*/