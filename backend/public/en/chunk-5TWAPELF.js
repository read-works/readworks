import{a as Q}from"./chunk-3L6YD2WL.js";import{a as J,b as q,d as Y,e as Z}from"./chunk-IBIHUJR6.js";import{b as K,c as v,h as j}from"./chunk-G3MELPCC.js";import{a as T}from"./chunk-5ESBBNVT.js";import{b as X}from"./chunk-PM5VPY4S.js";import{A as m,C as N,Fa as M,Ga as k,Ia as B,Ja as L,Ka as V,L as D,N as _,Ra as F,T as A,U as h,Z as S,aa as E,ca as I,fa as x,ga as C,ia as O,ja as R,ka as s,la as a,ma as w,mb as U,na as P,oa as b,ob as $,pa as g,pb as f,sa as y,tb as H,ub as G,w as l,wa as u,xa as i,xb as W,yb as z,z as p}from"./chunk-V52KVE3Z.js";var oe=["casePageNotesContainer"],ie=o=>[o];function re(o,d){if(o&1){let e=g();s(0,"rw-note",3),u("closeNotes",function(n){p(e);let r=i();return m(r.handleCloseNoteView(n));}),a();}if(o&2){let e=i();E("page",e.currentContextPage)("note",e.noteToEdit);}}function se(o,d){if(o&1){let e=g();s(0,"rw-page-image",9),u("dimensionChanged",function(n){p(e);let r=i(4);return m(r.scaleEditorView(n.width,n.height));}),s(1,"div",10)(2,"span",11),B(3),a()()();}if(o&2){let e=i().$implicit,t=i().$implicit,n=i(2);E("routerLink",F(7,ie,"../pages/"+t.id.toString()))("fragment",e.id.toString())("page",e)("showContext",!0)("showLightModeShadow",n.showLightModeShadow)("interactive",!0),_(3),L(e.pageNumber);}}function ae(o,d){if(o&1){let e=g();s(0,"div")(1,"rw-notes-list",12),u("noteSelected",function(n){p(e);let r=i().$implicit,c=i(3);return m(c.editNote(r,n));})("noteSelectedForDeletion",function(n){p(e);let r=i(4);return m(r.deleteNote(n));}),a()();}if(o&2){let e=i().$implicit,t=i(3);_(),E("notes",e.notes)("showLightModeShadow",t.showLightModeShadow);}}function _e(o,d){if(o&1&&(s(0,"div",4)(1,"div",5)(2,"h3",6),B(3),a(),S(4,se,4,9,"rw-page-image",7),a(),s(5,"div",8),S(6,ae,2,2,"div"),a()()),o&2){let e=d.$implicit,t=i().$implicit,n=i(2);_(2),I("text-slate-600",n.standalone)("dark:text-white",n.standalone)("text-white",!n.standalone),_(),V(" ",t.originalName," "),_(),C(n.previewPageId!==e.id?4:-1),_(2),C(e.notes?6:-1);}}function ce(o,d){if(o&1&&O(0,_e,7,9,"div",4,x().pageTrackByFunction,!0),o&2){let e=d.$implicit;R(e.pages);}}function le(o,d){if(o&1&&O(0,ce,2,0,null,null,x().caseTrackByFunction,!0),o&2){let e=i();R(e.caseDocumentsPageNotes);}}var ee=(()=>{class o{settingsService=l(H);notesService=l(q);subscriptionStore=l(v);socket=l(T);currentCase;currentDocument;openedPageId;noHeadline=!1;standalone=!1;showLightModeShadow=!1;set filterNotesBy(e){this.fetchCasePageNotes(e.length?e:void 0);}bookmarkForPageChanged=new N();deadSpaceClicked=new N();detailViewActive=new N();notesVisible=new N();casePageNotesContainer=A("casePageNotesContainer");caseDocumentsPageNotes;note;blendInControls=!1;currentContextPage;noteToEdit;calculatedPreviewWidth;calculatedPreviewHeight;preview;previewPageId;showFilterInput=!1;constructor(){let e=this.subscriptionStore.getStore("noteBrowserComponent");e.push(this.settingsService.fetchSettings().subscribe(t=>{this.blendInControls=t.blendControls;})),e.push(this.socket.fromEvent("updateNotes").subscribe(()=>{e.push(this.fetchCasePageNotes());})),e.push(this.socket.fromEvent("update").subscribe(t=>{["documentDestroyed","searchCreated","searchDeleted","searchResultExcluded","noteCreated","noteUpdated","noteDeleted"].includes(t.name)&&e.push(this.fetchCasePageNotes());}));}ngOnInit(){this.fetchCasePageNotes();}ngOnDestroy(){this.subscriptionStore.destroy("noteBrowserComponent");}fetchCasePageNotes(e){return this.notesService.fetchNotesInCase(this.currentCase,e).subscribe(t=>{this.caseDocumentsPageNotes=t,this.showFilterInput=!!this.caseDocumentsPageNotes.length,this.notesVisible.next(this.showFilterInput),this.syncCurrentlyOpenedNoteContent();});}syncCurrentlyOpenedNoteContent(){this.noteToEdit&&this.currentContextPage&&this.caseDocumentsPageNotes&&this.caseDocumentsPageNotes.some(e=>e.pages&&e.pages.some(t=>t.notes&&t.notes.some(n=>n.id===this.noteToEdit?.id&&JSON.stringify(n.content)!==JSON.stringify(this.noteToEdit.content)?(this.noteToEdit.content=n.content,!0):!1)));}editNote(e,t){this.currentContextPage=e,this.noteToEdit=t;}deleteNote(e){this.notesService.delete(e).subscribe();}handleCloseNoteView(e){this.noteToEdit=void 0,this.currentContextPage=void 0;let t=this.casePageNotesContainer();t&&e&&t.nativeElement.scrollTo(0,0);}scaleEditorView(e,t){this.calculatedPreviewWidth=e+"px",this.calculatedPreviewHeight=t+"px";}caseTrackByFunction(e,t){return t.originalName;}pageTrackByFunction(e,t){return t.filename;}deadSpaceClick(e){e.currentTarget===e.target&&this.deadSpaceClicked.emit(e);}document=document;static ɵfac=function(t){return new(t||o)();};static ɵcmp=h({type:o,selectors:[["rw-note-browser"]],viewQuery:function(t,n){t&1&&M(n.casePageNotesContainer,oe,5),t&2&&k();},hostAttrs:[1,"block","w-full","h-full","py-0"],inputs:{currentCase:"currentCase",currentDocument:"currentDocument",openedPageId:"openedPageId",noHeadline:"noHeadline",standalone:"standalone",showLightModeShadow:"showLightModeShadow",filterNotesBy:"filterNotesBy"},outputs:{bookmarkForPageChanged:"bookmarkForPageChanged",deadSpaceClicked:"deadSpaceClicked",detailViewActive:"detailViewActive",notesVisible:"notesVisible"},decls:4,vars:2,consts:[["casePageNotesContainer",""],[3,"page","note"],[1,"overflow-y-scroll","h-full",3,"click"],[3,"closeNotes","page","note"],[1,"flex"],[1,"overflow-hidden","w-2/6","sticky","top-0",2,"align-self","flex-start"],[1,"bookmarked-documents-headline","mt-6","text-lg"],[1,"opacity-0","max-w","bookmarked-documents-bookmark","current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"routerLink","fragment","page","showContext","showLightModeShadow","interactive"],[1,"w-4/6","pt-20","pl-4"],[1,"opacity-0","max-w","bookmarked-documents-bookmark","current-document-bookmark","scale-95","md:hover:z-40","noPadding",3,"dimensionChanged","routerLink","fragment","page","showContext","showLightModeShadow","interactive"],[1,"text-xs","-mt-5","relative","pointer-events-none"],[1,"text-black","pointer-events-none","text-center","px-1","border","border-black","rounded-lg","bg-white","bg-opacity-70","border-opacity-20"],["type","list",3,"noteSelected","noteSelectedForDeletion","notes","showLightModeShadow"]],template:function(t,n){if(t&1){let r=g();S(0,re,1,2,"rw-note",1),s(1,"div",2,0),u("click",function(te){return p(r),m(n.deadSpaceClick(te));}),S(3,le,2,0),a();}t&2&&(C(n.currentContextPage&&n.noteToEdit?0:-1),_(3),C(n.caseDocumentsPageNotes?3:-1));},dependencies:[Z,J,f,Y],styles:["@keyframes _ngcontent-%COMP%_animate-fade-in{0%{opacity:0}to{opacity:100}}rw-page-image[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_animate-fade-in;animation-duration:.5s;animation-fill-mode:forwards}"]});}return o;})();function de(o,d){if(o&1){let e=g();s(0,"rw-input",13),u("valueChange",function(n){p(e);let r=i();return m(r.filterNotesByInput(n));}),a();}if(o&2){let e=i();E("clearOnSubmit",!0)("autoFocus",!0)("value",e.filterNotesBy);}}function Ce(o,d){if(o&1){let e=g();s(0,"rw-button",14),u("clicked",function(){p(e);let n=i();return m(n.filterNotesByInput(""));}),a();}}function ue(o,d){o&1&&w(0,"rw-loader");}function pe(o,d){o&1&&(s(0,"rw-alert",11)(1,"div",15),y(2,1),a()()),o&2&&E("showCancelBtn",!1)("showConfirmBtn",!1)("type","info");}var He=(()=>{class o{router=l($);route=l(U);subscriptionStorage=l(v);iaService=l(G);socket=l(T);searchService=l(K);isProcessing=!1;caseId;caseDeleted=!1;noteDetailViewOpened=!1;isFiltering=!1;filterNotesBy="";showNoteFilterInput=!1;filtering=!1;iaLayer="screen-case-notes-"+new Date().getTime();constructor(){if(this.caseId=this.route.snapshot.params.caseId,this.iaService.add(this.iaLayer),!this.caseId)return;this.searchService.getCaseId()||this.searchService.setCaseId(this.caseId),this.subscriptionStorage.getStore("screenCaseNotes").push(this.socket.fromEvent("caseToDelete-"+this.caseId).subscribe(()=>{this.caseDeleted=!0,setTimeout(()=>{this.router.navigate(["/cases"],{replaceUrl:!0});},4500);}));}close(){!this.noteDetailViewOpened&&this.iaService.is(this.iaLayer)&&this.router.navigate(["../"],{replaceUrl:!0,relativeTo:this.route});}filterNotesByInput(e){this.filtering=!!e.length,this.filterNotesBy=e;}ngOnDestroy(){this.subscriptionStorage.destroy("screenCaseNotes"),this.iaService.take(this.iaLayer);}static ɵfac=function(t){return new(t||o)();};static ɵcmp=h({type:o,selectors:[["rw-sub-screen-case-notes"]],hostBindings:function(t,n){t&1&&u("keydown.escape",function(c){return n.close(c);},!1,D);},decls:13,vars:12,consts:()=>{let e;e="Type something here that's contained on a note.";let t;t="Close note browser (ESC)";let n;n="Notes";let r;return r="This file was deleted in another window. The file overview is now being opened...",[n,r,[3,"showQr","showNavigation"],["header",""],[1,"grow","pl-3","md:pt-0","capitalize","text-2xl","md:text-4xl"],[1,"flex","pl-3","grow","max-w-[525px]"],["id","filterNotesInput","placeholder",e,1,"grow",3,"clearOnSubmit","autoFocus","value"],["icon","x-lg","styling","standard_outline",1,"inline-block","scale-75","origin-center","z-20","-ml-[44px]","-translate-y-px"],[1,"inline-block","w-0.5","h-[30px]","mx-2.5","rounded-md","bg-indigo-300","bg-opacity-50"],["title",t,"routerLink","../","icon","x-lg","styling","standard_outline",1,"mr-3"],["main",""],[3,"showCancelBtn","showConfirmBtn","type"],[3,"detailViewActive","notesVisible","standalone","noHeadline","currentCase","showLightModeShadow","filterNotesBy","currentDocument"],["id","filterNotesInput","placeholder",e,1,"grow",3,"valueChange","clearOnSubmit","autoFocus","value"],["icon","x-lg","styling","standard_outline",1,"inline-block","scale-75","origin-center","z-20","-ml-[44px]","-translate-y-px",3,"clicked"],[1,"text-lg"]];},template:function(t,n){t&1&&(s(0,"rw-page",2),P(1,3),s(2,"h3",4),y(3,0),a(),s(4,"div",5),S(5,de,1,3,"rw-input",6)(6,Ce,1,0,"rw-button",7),a(),w(7,"div",8),S(8,ue,1,0,"rw-loader"),w(9,"rw-button",9),b(),P(10,10),S(11,pe,3,3,"rw-alert",11),s(12,"rw-note-browser",12),u("detailViewActive",function(c){return n.noteDetailViewOpened=c;})("notesVisible",function(c){return n.showNoteFilterInput=c;}),a(),b(),a()),t&2&&(E("showQr",!n.isProcessing)("showNavigation",!0),_(5),C(n.showNoteFilterInput||n.filtering?5:-1),_(),C(n.filtering?6:-1),_(2),C(n.isProcessing?8:-1),_(3),C(n.caseDeleted?11:-1),_(),E("standalone",!0)("noHeadline",!0)("currentCase",n.caseId)("showLightModeShadow",!0)("filterNotesBy",n.filterNotesBy)("currentDocument",-1));},dependencies:[X,j,W,Q,f,z,ee],encapsulation:2});}return o;})();export{He as a};/**i18n:1964dde12af7df15d0053ab7761c4e4c56fe7eae085ef9e01bc7588ce5d2189d*/